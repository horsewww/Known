@inherits BaseComponent
@typeparam TItem where TItem : class, new()

@if (Model.Tree != null)
{
	<GridRow>
		<GridCol Span="4">
			<div style="padding:10px;">
				<Tree TItem="Known.MenuItem" ShowIcon
					DataSource="Model.Tree.Data" OnClick="OnTreeClick"
					KeyExpression="x => x.DataItem.Id"
					TitleExpression="x => x.DataItem.Name"
					IconExpression="x => x.DataItem.Icon"
					ChildrenExpression="x => x.DataItem.Children"
					IsLeafExpression="x => x.DataItem.Children?.Count == 0" />
			</div>
		</GridCol>
		<GridCol Span="20">
			<QueryForm TItem="TItem" Model="Model.Table" OnSearch="OnSearchAsync" />
			<Toolbar Items="Model.Tools" OnItemClick="Model.OnToolClick" />
			<DataTable @ref="table" TItem="TItem" Model="Model.Table" />
		</GridCol>
	</GridRow>
}
else
{
	<QueryForm TItem="TItem" Model="Model.Table" OnSearch="OnSearchAsync" />
	<Toolbar Items="Model.Tools" OnItemClick="Model.OnToolClick" />
	<DataTable @ref="table" TItem="TItem" Model="Model.Table" />
}

@code {
	DataTable<TItem> table;

	[Parameter] public PageModel<TItem> Model { get; set; }

	private Task OnSearchAsync() => table.RefreshAsync();

	private void OnTreeClick(TreeEventArgs<Known.MenuItem> e)
	{
		var children = e.Node.DataItem.Children;
		var data = children?.Select(c => (TItem)c.Data).ToList();
		table.SetData(data);
	}
}