@page "/"
@inherits IndexPage
@inject INotificationService _notice

<PageTitle>@AppConfig.Branch - @Language["App.SubTitle"]</PageTitle>

<KError OnError="OnError">
    <CascadingValue Value="this">
        @if (IsLoaded)
        {
            <Known.AntBlazor.Admin OnLogout="OnLogout" />
        }
    </CascadingValue>
</KError>

@code {
    private Task OnError(Exception ex)
    {
        var config = new NotificationConfig
        {
            Message = Language["Title.Error"],
            Description = ex.Message,
            Placement = NotificationPlacement.BottomRight,
            Duration = null
        };
        if (Config.App.IsDevelopment)
            config.Description = ex.ToString();
        return _notice.Error(config);
    }

    // //第三方登录设置当前用户
    // protected override async Task OnAfterRenderAsync(bool firstRender)
    // {
    //    if (firstRender)
    //        await SetCurrentUserAsync(CurrentUser);
    //    await base.OnAfterRenderAsync(firstRender);
    // }

    // //第三方登录获取当前用户
    // protected override async Task<UserInfo> GetThirdUserAsync()
    // {
    //    //var third = ThirdApi.GetUser();
    //    var third = new { UserName = "admin" };
    //    var user = await Platform.GetUserAsync(third.UserName);
    //    return user;
    // }
}